<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>XFootballHub - Mundial Penaltis 2022</title>
<style>
  /* Fuente moderna */
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap');

  /* Reset y base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(180deg, #3b8d99 0%, #6b4226 100%);
    color: #fff;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    overflow-x: hidden;
  }
  h1,h2,h3 {
    margin: 0;
  }
  button {
    cursor: pointer;
    border: none;
    border-radius: 6px;
    font-weight: 700;
    font-size: 1rem;
    padding: 10px 18px;
    background-color: #1de9b6;
    color: #004d40;
    box-shadow: 0 3px 6px rgba(0,0,0,0.3);
    transition: background-color 0.3s ease;
  }
  button:hover:not(:disabled) {
    background-color: #00bfa5;
  }
  button:disabled {
    background-color: #004d40;
    color: #a7ffeb88;
    cursor: default;
  }

  /* Contenedor general */
  #app {
    flex: 1;
    max-width: 900px;
    margin: 0 auto;
    padding: 10px 20px 30px 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* Cabecera */
  header {
    text-align: center;
    margin-bottom: 12px;
    user-select: none;
  }
  header h1 {
    font-size: 2.8rem;
    text-shadow: 0 3px 7px rgba(0,0,0,0.7);
  }
  header p {
    font-size: 1.1rem;
    margin-top: 6px;
    font-weight: 600;
    color: #a7ffebcc;
  }

  /* Equipo y selecci√≥n */
  #team-selection {
    margin: 15px 0 30px;
    width: 100%;
    max-width: 400px;
    background: rgba(0,0,0,0.3);
    padding: 12px 16px;
    border-radius: 14px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    user-select: none;
  }
  #team-selection label {
    font-weight: 600;
    font-size: 1.2rem;
  }
  #team-selection select {
    margin-left: 12px;
    font-size: 1.1rem;
    padding: 6px 8px;
    border-radius: 8px;
    border: none;
    outline: none;
    font-family: inherit;
  }

  /* √Årea del juego */
  #game-area {
    position: relative;
    width: 100%;
    max-width: 700px;
    height: 450px;
    background: linear-gradient(to top, #4CAF50 0%, #81C784 100%);
    border-radius: 20px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.7);
    overflow: hidden;
    user-select: none;
  }

  /* Porter√≠a - frontal */
  #goal {
    position: absolute;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    width: 460px;
    height: 210px;
    border: 5px solid white;
    border-radius: 0 0 50px 50px / 0 0 80px 80px;
    background: #ddd;
    box-shadow:
      inset 0 0 20px 3px rgba(255,255,255,0.85),
      0 0 25px 4px rgba(255,255,255,0.7);
  }
  #goal::before {
    content: '';
    position: absolute;
    top: 5px; left: 50%;
    transform: translateX(-50%);
    width: 440px;
    height: 5px;
    background: white;
    border-radius: 10px;
  }

  /* Divisiones de zonas de tiro (9 rect√°ngulos) */
  .shoot-zone {
    position: absolute;
    border: 2px dashed rgba(30,230,182,0.7);
    cursor: pointer;
    transition: background-color 0.3s ease;
    border-radius: 8px;
  }
  .shoot-zone:hover {
    background-color: rgba(30,230,182,0.3);
  }
  /* Grid para 9 zonas dentro de la porter√≠a */
  #zones-container {
    position: absolute;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    width: 460px;
    height: 210px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    gap: 10px;
    pointer-events: none; /* desactivado hasta que habilitemos */
  }
  .shoot-zone {
    pointer-events: auto; /* activar para zonas */
  }

  /* Personajes y bal√≥n (canvas animado) */
  #field-canvas {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 700px;
    height: 450px;
    z-index: 10;
    background: transparent;
  }

  /* Zona inferior donde se ven botones e info */
  #controls {
    margin-top: 20px;
    width: 100%;
    max-width: 700px;
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
    gap: 12px;
  }

  #difficulty-select {
    font-size: 1rem;
    padding: 8px 12px;
    border-radius: 8px;
    border: none;
    outline: none;
    font-family: inherit;
  }
  #start-btn {
    flex: 1 1 160px;
  }
  #next-match-btn {
    flex: 1 1 160px;
    display: none;
  }

  /* Mensajes y estado */
  #message-box {
    margin-top: 20px;
    font-weight: 700;
    font-size: 1.3rem;
    min-height: 2rem;
    text-align: center;
    color: #e0f7fa;
    text-shadow: 0 0 6px #00bfa5;
    user-select: none;
  }

  /* Responsive */
  @media (max-width: 800px) {
    #game-area {
      width: 100%;
      height: 320px;
    }
    #goal {
      width: 320px;
      height: 145px;
      bottom: 25px;
    }
    #zones-container {
      width: 320px;
      height: 145px;
      bottom: 25px;
    }
    #field-canvas {
      width: 100%;
      height: 320px;
    }
    #controls {
      max-width: 100%;
      gap: 8px;
    }
  }
  @media (max-width: 400px) {
    header h1 {
      font-size: 2rem;
    }
    button {
      padding: 8px 14px;
      font-size: 0.9rem;
    }
  }

</style>
</head>
<body>

<div id="app">
  <header>
    <h1>‚öΩ Mundial Penaltis 2022</h1>
    <p>Selecciona tu equipo y lanza penales para ganar el Mundial</p>
  </header>

  <section id="team-selection">
    <label for="team-select">Elige tu equipo:</label>
    <select id="team-select" aria-label="Selecci√≥n de equipo para el torneo"></select>
  </section>

  <section id="game-area" aria-label="Campo de penaltis">
    <div id="goal" role="img" aria-label="Porter√≠a de futbol"></div>

    <!-- Zonas para tirar -->
    <div id="zones-container" aria-label="Zonas de tiro">
      <div class="shoot-zone" data-zone="0" aria-label="Zona tiro arriba izquierda"></div>
      <div class="shoot-zone" data-zone="1" aria-label="Zona tiro arriba centro"></div>
      <div class="shoot-zone" data-zone="2" aria-label="Zona tiro arriba derecha"></div>
      <div class="shoot-zone" data-zone="3" aria-label="Zona tiro medio izquierda"></div>
      <div class="shoot-zone" data-zone="4" aria-label="Zona tiro medio centro"></div>
      <div class="shoot-zone" data-zone="5" aria-label="Zona tiro medio derecha"></div>
      <div class="shoot-zone" data-zone="6" aria-label="Zona tiro abajo izquierda"></div>
      <div class="shoot-zone" data-zone="7" aria-label="Zona tiro abajo centro"></div>
      <div class="shoot-zone" data-zone="8" aria-label="Zona tiro abajo derecha"></div>
    </div>

    <!-- Canvas para dibujo animaciones -->
    <canvas id="field-canvas" width="700" height="450" aria-label="Animaci√≥n del juego"></canvas>
  </section>

  <section id="controls" aria-label="Controles del juego">
    <select id="difficulty-select" aria-label="Selecciona dificultad">
      <option value="1">F√°cil</option>
      <option value="2">Medio</option>
      <option value="3">Dif√≠cil</option>
    </select>
    <button id="start-btn" aria-label="Iniciar partido">Iniciar partido</button>
    <button id="next-match-btn" aria-label="Siguiente partido">Siguiente partido</button>
  </section>

  <section id="message-box" role="alert" aria-live="polite"></section>
</div>

<script>
(() => {
  // Configuraciones b√°sicas
  const TEAMS = [
    { name: 'Argentina', color: '#75aadb', flag: 'üá¶üá∑' },
    { name: 'Brasil', color: '#009b3a', flag: 'üáßüá∑' },
    { name: 'Francia', color: '#0055a4', flag: 'üá´üá∑' },
    { name: 'Inglaterra', color: '#cf142b', flag: 'üè¥' },
    { name: 'Espa√±a', color: '#aa151b', flag: 'üá™üá∏' },
    { name: 'Alemania', color: '#000', flag: 'üá©üá™' },
    { name: 'Portugal', color: '#006200', flag: 'üáµüáπ' },
    { name: 'Pa√≠ses Bajos', color: '#ff6a00', flag: 'üá≥üá±' },
  ];

  // Estado del juego
  let playerTeam = null;
  let opponentTeam = null;
  let difficulty = 1;

  // Canvas y contexto
  const canvas = document.getElementById('field-canvas');
  const ctx = canvas.getContext('2d');

  // Zonas de tiro con coordenadas relativas al canvas
  // Cada zona: { x, y, w, h } para centrar el bal√≥n en esa zona
  const zoneCoordinates = [
    {x: 125, y: 90}, {x: 350, y: 90}, {x: 575, y: 90},
    {x: 125, y: 190}, {x: 350, y: 190}, {x: 575, y: 190},
    {x: 125, y: 300}, {x: 350, y: 300}, {x: 575, y: 300},
  ];

  // Tama√±os personajes
  const PLAYER_SIZE = { width: 60, height: 130 };
  const GOALIE_SIZE = { width: 60, height: 130 };
  const BALL_RADIUS = 18;

  // Estado animaci√≥n
  let animating = false;
  let animationFrameId = null;

  // Par√°metros animaci√≥n
  let ballPos = { x: 350, y: 380 }; // posici√≥n inicial bal√≥n (pie del tirador)
  let ballTarget = null;
  let ballMoving = false;

  let goaliePos = { x: 350, y: 120 }; // portero centro
  let goalieTargetX = null;
  let goalieMoving = false;

  // Resultado y turno
  let isShooting = false;
  let currentShotZone = null;
  let goalsScored = 0;
  let shotsTaken = 0;
  let maxShots = 5;

  // DOM references
  const teamSelect = document.getElementById('team-select');
  const difficultySelect = document.getElementById('difficulty-select');
  const startBtn = document.getElementById('start-btn');
  const nextMatchBtn = document.getElementById('next-match-btn');
  const messageBox = document.getElementById('message-box');
  const zonesContainer = document.getElementById('zones-container');
  const shootZones = document.querySelectorAll('.shoot-zone');

  // Inicializar selecci√≥n equipos
  function initTeamSelection() {
    TEAMS.forEach((team, idx) => {
      const option = document.createElement('option');
      option.value = idx;
      option.textContent = `${team.flag} ${team.name}`;
      teamSelect.appendChild(option);
    });
  }

  // Dibujar personaje humanoide simple - tirador o portero
  // Posici√≥n x,y = centro base, color = camiseta
  function drawCharacter(x, y, color, isGoalie = false, animationState = {}) {
    const headRadius = 20;
    const bodyWidth = 50;
    const bodyHeight = 90;

    // Sombra
    ctx.shadowColor = 'rgba(0,0,0,0.2)';
    ctx.shadowBlur = 6;
    ctx.shadowOffsetY = 6;

    // Cabeza
    ctx.fillStyle = '#fce1c4';
    ctx.beginPath();
    ctx.ellipse(x, y - bodyHeight - headRadius, headRadius, headRadius + 3, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.closePath();

    // Cuello
    ctx.fillRect(x - 8, y - bodyHeight, 16, 10);

    // Cuerpo
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.ellipse(x, y - bodyHeight / 2, bodyWidth / 2, bodyHeight / 2, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.closePath();

    // Piernas (simplificado)
    ctx.strokeStyle = '#333';
    ctx.lineWidth = 6;
    ctx.lineCap = 'round';

    // Pierna izquierda
    ctx.beginPath();
    ctx.moveTo(x - 15, y);
    ctx.lineTo(x - 20, y + 55);
    ctx.stroke();

    // Pierna derecha
    ctx.beginPath();
    ctx.moveTo(x + 15, y);
    ctx.lineTo(x + 20, y + 55);
    ctx.stroke();

    // Brazos animados - portero salta para cubrir zona
    ctx.lineWidth = 10;
    ctx.strokeStyle = color;

    if (isGoalie && animationState.goalieDive) {
      // Portero brazo hacia izquierda o derecha
      ctx.beginPath();
      ctx.moveTo(x, y - bodyHeight + 20);
      ctx.lineTo(x + animationState.goalieDive * 50, y - bodyHeight + 70);
      ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(x, y - bodyHeight + 20);
      ctx.lineTo(x - animationState.goalieDive * 30, y - bodyHeight + 60);
      ctx.stroke();
    } else {
      // Tirador brazos
      ctx.beginPath();
      ctx.moveTo(x, y - bodyHeight + 30);
      ctx.lineTo(x - 20, y - bodyHeight + 60);
      ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(x, y - bodyHeight + 30);
      ctx.lineTo(x + 20, y - bodyHeight + 60);
      ctx.stroke();
    }

    ctx.shadowBlur = 0;
  }

  // Dibujar porter√≠a (opcional para mejorar)
  function drawGoal() {
    // La porter√≠a ya est√° en CSS, aqu√≠ puede ir la red o detalles
  }

  // Dibujar bal√≥n (c√≠rculo con detalles)
  function drawBall(x, y) {
    // Sombra
    ctx.shadowColor = 'rgba(0,0,0,0.7)';
    ctx.shadowBlur = 12;
    ctx.shadowOffsetX = 3;
    ctx.shadowOffsetY = 3;

    // Cuerpo bal√≥n
    ctx.fillStyle = '#fff';
    ctx.beginPath();
    ctx.arc(x, y, BALL_RADIUS, 0, Math.PI * 2);
    ctx.fill();

    // Detalles pent√°gonos negros
    ctx.fillStyle = '#000';
    // Simple pent√°gono frontal
    ctx.beginPath();
    ctx.moveTo(x, y - BALL_RADIUS / 2);
    for(let i=1; i<5; i++) {
      const angle = i * (Math.PI * 2 / 5) - Math.PI / 2;
      ctx.lineTo(x + Math.cos(angle) * BALL_RADIUS / 2, y + Math.sin(angle) * BALL_RADIUS / 2);
    }
    ctx.closePath();
    ctx.fill();

    // Reset shadow
    ctx.shadowBlur = 0;
    ctx.shadowOffsetX = 0;
    ctx.shadowOffsetY = 0;
  }

  // Animar tiro y portero
  function animateShot() {
    if (!ballMoving) return;

    // Mover bal√≥n hacia objetivo (suavizado)
    const speed = 15 + difficulty * 5; // m√°s r√°pido en dificultad alta
    const dx = ballTarget.x - ballPos.x;
    const dy = ballTarget.y - ballPos.y;
    const dist = Math.sqrt(dx * dx + dy * dy);

    if (dist < speed) {
      ballPos.x = ballTarget.x;
      ballPos.y = ballTarget.y;
      ballMoving = false;

      // Verificar si portero ataj√≥ (acierto en zona)
      const zoneX = goaliePos.x;
      const targetX = ballTarget.x;
      const catchMargin = 60 - (difficulty * 10);
      const caught = Math.abs(zoneX - targetX) < catchMargin;

      if (caught) {
        messageBox.textContent = '¬°Parada del portero! üö´';
      } else {
        messageBox.textContent = '¬°GOOOOL! üéâ';
        goalsScored++;
      }

      shotsTaken++;

      // Habilitar siguiente acci√≥n
      startBtn.textContent = shotsTaken < maxShots ? 'Tirar siguiente penalti' : 'Finalizar partido';
      startBtn.disabled = false;

      if (shotsTaken >= maxShots) {
        startBtn.disabled = true;
        nextMatchBtn.style.display = 'inline-block';
        messageBox.textContent += ` Resultado final: ${goalsScored} / ${maxShots}`;
      }
      return;
    }

    // Mover portero hacia objetivo (simulaci√≥n r√°pida)
    if (goalieMoving) {
      const goalieSpeed = 25;
      if (Math.abs(goalieTargetX - goaliePos.x) < goalieSpeed) {
        goaliePos.x = goalieTargetX;
        goalieMoving = false;
      } else {
        goaliePos.x += goaliePos.x < goalieTargetX ? goalieSpeed : -goalieSpeed;
      }
    }

    // Mover bal√≥n
    ballPos.x += (dx / dist) * speed;
    ballPos.y += (dy / dist) * speed;

    drawFrame();

    animationFrameId = requestAnimationFrame(animateShot);
  }

  // Dibujar cada frame
  function drawFrame() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Fondo campo simple (c√©sped)
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#4caf50');
    gradient.addColorStop(1, '#81c784');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Dibujar porter√≠a (un marco simple para reforzar)
    ctx.strokeStyle = 'white';
    ctx.lineWidth = 6;
    ctx.beginPath();
    ctx.moveTo(120, 120);
    ctx.lineTo(580, 120);
    ctx.lineTo(580, 320);
    ctx.lineTo(120, 320);
    ctx.closePath();
    ctx.stroke();

    // Dibujar redes (l√≠neas verticales y horizontales)
    ctx.strokeStyle = 'rgba(255,255,255,0.15)';
    ctx.lineWidth = 2;
    for(let x=150; x<580; x+=40) {
      ctx.beginPath();
      ctx.moveTo(x,120);
      ctx.lineTo(x,320);
      ctx.stroke();
    }
    for(let y=160; y<320; y+=30) {
      ctx.beginPath();
      ctx.moveTo(120,y);
      ctx.lineTo(580,y);
      ctx.stroke();
    }

    // Dibujar zonas (transparentes)
    shootZones.forEach(zone => {
      const rect = zone.getBoundingClientRect();
      // no dibujamos en canvas, zonas est√°n en HTML
    });

    // Dibujar personajes

    // Tirador - posici√≥n base (pie bal√≥n)
    const playerX = 350;
    const playerY = 410;
    drawCharacter(playerX, playerY, playerTeam.color, false);

    // Portero animado (se mueve lateralmente para intentar atajar)
    const goalieAnimation = {
      goalieDive: goalieMoving ? (goalieTargetX < goaliePos.x ? -1 : 1) : 0
    };
    drawCharacter(goaliePos.x, goaliePos.y, opponentTeam.color, true, goalieAnimation);

    // Dibujar bal√≥n
    drawBall(ballPos.x, ballPos.y);
  }

  // Seleccionar zona para disparar
  function onZoneSelected(e) {
    if (animating || isShooting || shotsTaken >= maxShots) return;
    const zone = e.currentTarget.getAttribute('data-zone');
    if (zone === null) return;

    // Definir objetivo bal√≥n y portero
    currentShotZone = parseInt(zone);

    ballTarget = {
      x: zoneCoordinates[currentShotZone].x,
      y: zoneCoordinates[currentShotZone].y
    };

    // Portero intenta adivinar
    goalieTargetX = calculateGoalieTarget(ballTarget.x);

    // Iniciar animaci√≥n disparo
    isShooting = true;
    ballMoving = true;
    goalieMoving = true;
    startBtn.disabled = true;
    messageBox.textContent = '¬°Tirando penalti...';

    animateShot();
  }

  // Calcular posici√≥n del portero para intentar parar
  function calculateGoalieTarget(ballX) {
    // El portero es m√°s listo en dificultad alta (m√°s chances de atajar)
    let randomness = 80 - difficulty * 20;
    randomness = Math.max(randomness, 20);

    const guess = ballX + (Math.random() * randomness * 2 - randomness);
    // Limitar dentro porter√≠a
    return Math.min(Math.max(guess, 120 + GOALIE_SIZE.width / 2), 580 - GOALIE_SIZE.width / 2);
  }

  // Empezar nuevo partido
  function startGame() {
    if (animating || isShooting) return;
    goalsScored = 0;
    shotsTaken = 0;
    currentShotZone = null;

    messageBox.textContent = 'Selecciona una zona para tirar el penalti';
    startBtn.textContent = 'Tirar penalti';
    startBtn.disabled = true;
    nextMatchBtn.style.display = 'none';

    // Elegir equipo rival aleatorio diferente
    do {
      opponentTeam = TEAMS[Math.floor(Math.random() * TEAMS.length)];
    } while (opponentTeam === playerTeam);

    // Reset posiciones bal√≥n y portero
    ballPos = { x: 350, y: 380 };
    goaliePos = { x: 350, y: 120 };
    goalieMoving = false;
    ballMoving = false;
    isShooting = false;

    // Activar zonas para disparar
    zonesContainer.style.pointerEvents = 'auto';

    drawFrame();

    animating = false;
  }

  // Iniciar el juego o siguiente tiro
  function onStartBtnClick() {
    if (shotsTaken >= maxShots) return;

    if (isShooting) return; // ya en animaci√≥n

    if (currentShotZone === null) {
      messageBox.textContent = '¬°Selecciona una zona para tirar!';
      return;
    }

    // Deshabilitar zonas y bot√≥n durante animaci√≥n
    zonesContainer.style.pointerEvents = 'none';

    // Reset bal√≥n y portero para animaci√≥n
    ballPos = { x: 350, y: 380 };
    goaliePos = { x: 350, y: 120 };
    goalieMoving = true;
    ballMoving = true;
    isShooting = true;

    startBtn.disabled = true;
    messageBox.textContent = '¬°Tirando penalti...';

    animateShot();
  }

  // Cambio dificultad
  difficultySelect.addEventListener('change', () => {
    difficulty = parseInt(difficultySelect.value);
  });

  // Cambio equipo
  teamSelect.addEventListener('change', () => {
    playerTeam = TEAMS[parseInt(teamSelect.value)];
  });

  // Siguiente partido
  nextMatchBtn.addEventListener('click', () => {
    startGame();
    nextMatchBtn.style.display = 'none';
    startBtn.disabled = false;
  });

  // Selecci√≥n zona tiro
  shootZones.forEach(zone => {
    zone.addEventListener('click', onZoneSelected);
  });

  // Bot√≥n iniciar / siguiente tiro
  startBtn.addEventListener('click', () => {
    if (shotsTaken === 0) {
      // Primer disparo comienza el juego
      if (!playerTeam) {
        messageBox.textContent = 'Por favor selecciona tu equipo primero.';
        return;
      }
      startGame();
      startBtn.disabled = false;
      messageBox.textContent = 'Selecciona una zona para tirar el penalti';
    } else {
      onStartBtnClick();
    }
  });

  // Inicializaci√≥n
  function init() {
    initTeamSelection();
    playerTeam = TEAMS[0];
    teamSelect.value = 0;
    difficulty = parseInt(difficultySelect.value);
    drawFrame();
    messageBox.textContent = 'Selecciona tu equipo y presiona "Iniciar partido"';
  }

  init();

})();
</script>

</body>
</html>
