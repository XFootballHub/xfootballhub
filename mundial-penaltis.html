<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Penaltis Mundial 2022 - Juego Mejorado</title>
<style>
  /* Reset básico */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(180deg, #007a0c 0%, #70bf4e 100%);
    margin: 0;
    color: #222;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  header {
    background: #004d00;
    color: #d0f0c0;
    padding: 1rem;
    text-align: center;
    box-shadow: 0 4px 8px #003300aa;
  }
  header h1 {
    margin: 0 0 0.3rem 0;
    font-weight: 900;
    font-size: 1.8rem;
    letter-spacing: 2px;
  }
  header p {
    margin: 0;
    font-style: italic;
    font-weight: 600;
  }
  main {
    flex: 1;
    padding: 1rem;
    max-width: 480px;
    margin: 0 auto;
    width: 100%;
  }

  /* Teams selection */
  #team-selection h2 {
    text-align: center;
    margin-bottom: 0.5rem;
    font-weight: 700;
  }
  #teams-list {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(90px,1fr));
    gap: 0.6rem;
    justify-items: center;
  }
  .team-card {
    cursor: pointer;
    border-radius: 8px;
    background: #fff;
    padding: 0.3rem;
    width: 90px;
    text-align: center;
    user-select: none;
    box-shadow: 0 3px 8px #00330055;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .team-card:hover, .team-card:focus {
    box-shadow: 0 6px 15px #007a0ccc;
    transform: translateY(-4px);
    outline: none;
  }
  .team-card img {
    width: 48px;
    height: 32px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
  .team-card span {
    font-size: 0.85rem;
    display: block;
    margin-top: 0.3rem;
    font-weight: 700;
  }

  /* Juego */
  #game-container {
    margin-top: 1rem;
    display: none;
  }
  #stage-title {
    text-align: center;
    font-weight: 800;
    font-size: 1.2rem;
    color: #004d00;
    margin-bottom: 0.3rem;
  }
  #match-info {
    text-align: center;
    font-weight: 700;
    font-size: 1rem;
    margin-bottom: 1rem;
    color: #1b3a00;
  }

  /* Campo de penales */
  #field {
    position: relative;
    background: linear-gradient(to bottom, #3f8a2a 0%, #1c4300 100%);
    border: 3px solid #fff;
    border-radius: 15px;
    width: 100%;
    max-width: 480px;
    aspect-ratio: 3 / 4;
    margin: 0 auto 1rem;
    box-shadow: 0 0 20px #006400cc inset;
  }

  /* Líneas campo */
  #field::before {
    content: '';
    position: absolute;
    bottom: 140px;
    left: 50%;
    transform: translateX(-50%);
    width: 180px;
    height: 4px;
    background: white;
    border-radius: 2px;
  }
  #field::after {
    content: '';
    position: absolute;
    bottom: 140px;
    left: 50%;
    transform: translateX(-50%);
    width: 6px;
    height: 6px;
    background: white;
    border-radius: 50%;
    box-shadow: 0 0 8px 2px white;
  }

  /* Portería */
  #goal {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 280px;
    height: 130px;
    border: 6px solid white;
    border-bottom: none;
    border-radius: 0 0 100px 100px / 0 0 80px 80px;
    box-shadow: 0 0 15px #ffffffaa;
    background: #eaf3f9dd;
  }

  /* Zona para disparar */
  .goal-zone {
    position: absolute;
    width: 33.33%;
    height: 33.33%;
    border: 1px dashed transparent;
    cursor: pointer;
    transition: border-color 0.3s ease;
  }
  .goal-zone:hover, .goal-zone.selected {
    border-color: #44dd55;
  }
  /* Dividimos la portería en 9 zonas para puntería */
  /* fila 1 */
  .row-1.col-1 { top: 5px; left: 0; }
  .row-1.col-2 { top: 5px; left: 33.33%; }
  .row-1.col-3 { top: 5px; left: 66.66%; }
  /* fila 2 */
  .row-2.col-1 { top: 47px; left: 0; }
  .row-2.col-2 { top: 47px; left: 33.33%; }
  .row-2.col-3 { top: 47px; left: 66.66%; }
  /* fila 3 */
  .row-3.col-1 { top: 90px; left: 0; }
  .row-3.col-2 { top: 90px; left: 33.33%; }
  .row-3.col-3 { top: 90px; left: 66.66%; }

  /* Jugador tirador */
  #player {
    position: absolute;
    bottom: 40px;
    left: 100px;
    width: 75px;
    height: 160px;
    cursor: default;
    z-index: 5;
    user-select: none;
  }
  /* Cuerpo jugador - humanoide simplificado */
  #player .human-body {
    width: 60px;
    height: 130px;
    margin: 0 auto;
    border-radius: 20px 20px 10px 10px;
    background: linear-gradient(to bottom, #004d99, #003366);
    box-shadow: inset 0 0 10px #001733;
  }
  /* Cabeza jugador */
  #player .human-head {
    width: 50px;
    height: 50px;
    margin: 0 auto;
    background: #f1c27d;
    border-radius: 50%;
    border: 2px solid #8b5d3c;
    box-shadow: inset 0 5px 5px #d9b38c;
  }
  /* Player color by team (example France) */
  #player[data-team="France"] .human-body {
    background: linear-gradient(to bottom, #233e8b, #192c66);
  }
  #player[data-team="Brazil"] .human-body {
    background: linear-gradient(to bottom, #009b3a, #005927);
  }
  #player[data-team="Spain"] .human-body {
    background: linear-gradient(to bottom, #bf001f, #7a000f);
  }
  /* Más colores se pueden añadir igual */

  /* Portero */
  #keeper {
    position: absolute;
    top: 20px;
    right: 60px;
    width: 75px;
    height: 150px;
    user-select: none;
    z-index: 6;
    cursor: default;
  }
  #keeper .human-body {
    width: 60px;
    height: 130px;
    margin: 0 auto;
    border-radius: 20px 20px 10px 10px;
    background: linear-gradient(to bottom, #222222, #444444);
    box-shadow: inset 0 0 8px #000000aa;
    transition: transform 0.5s ease;
  }
  #keeper .human-head {
    width: 48px;
    height: 48px;
    margin: 0 auto;
    background: #f1c27d;
    border-radius: 50%;
    border: 2px solid #8b5d3c;
    box-shadow: inset 0 5px 5px #d9b38c;
  }
  /* Animación portero saltando */
  #keeper.jump-left .human-body {
    transform-origin: center bottom;
    animation: jump-left 0.5s forwards;
  }
  #keeper.jump-right .human-body {
    transform-origin: center bottom;
    animation: jump-right 0.5s forwards;
  }
  @keyframes jump-left {
    0% { transform: translate(0,0) rotate(0deg); }
    50% { transform: translate(-40px,-50px) rotate(-20deg);}
    100% { transform: translate(0,0) rotate(0deg); }
  }
  @keyframes jump-right {
    0% { transform: translate(0,0) rotate(0deg); }
    50% { transform: translate(40px,-50px) rotate(20deg);}
    100% { transform: translate(0,0) rotate(0deg); }
  }

  /* Balón */
  #ball {
    position: absolute;
    bottom: 75px;
    left: 130px;
    width: 50px;
    height: 50px;
    background: white;
    border-radius: 50%;
    box-shadow:
      inset 0 0 5px #666,
      0 2px 5px rgba(0,0,0,0.3);
    z-index: 10;
    transition: left 0.6s ease, bottom 0.6s ease;
    cursor: default;
    background-image:
      radial-gradient(circle at 15px 15px, #222 6px, transparent 7px),
      radial-gradient(circle at 35px 15px, #222 6px, transparent 7px),
      radial-gradient(circle at 25px 35px, #222 6px, transparent 7px);
    background-repeat: no-repeat;
  }
  /* Animación disparo balón */
  #ball.shoot-left {
    animation: shoot-left 0.7s forwards;
  }
  #ball.shoot-center {
    animation: shoot-center 0.7s forwards;
  }
  #ball.shoot-right {
    animation: shoot-right 0.7s forwards;
  }
  @keyframes shoot-left {
    0% { left: 130px; bottom: 75px; }
    100% { left: 80px; bottom: 260px; }
  }
  @keyframes shoot-center {
    0% { left: 130px; bottom: 75px; }
    100% { left: 140px; bottom: 280px; }
  }
  @keyframes shoot-right {
    0% { left: 130px; bottom: 75px; }
    100% { left: 200px; bottom: 260px; }
  }

  /* Botones */
  .buttons-container {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 1rem;
  }
  button {
    background-color: #28a745;
    border: none;
    color: white;
    font-weight: 700;
    padding: 0.6rem 1.2rem;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    box-shadow: 0 4px 6px #1c5f23cc;
    transition: background-color 0.3s ease;
  }
  button:disabled {
    background-color: #94d3a2;
    cursor: not-allowed;
    box-shadow: none;
  }
  button:hover:not(:disabled) {
    background-color: #218838;
  }

  /* Info panel */
  #info-panel {
    text-align: center;
    font-weight: 700;
    font-size: 1rem;
    color: #004400;
    margin-top: 1rem;
    min-height: 1.5em;
  }

  /* Responsive */
  @media (max-width: 600px) {
    #field {
      max-width: 100%;
      aspect-ratio: 3 / 4;
    }
    #player, #keeper {
      width: 55px;
      height: 115px;
    }
    #player .human-body, #keeper .human-body {
      width: 45px;
      height: 100px;
    }
    #player .human-head, #keeper .human-head {
      width: 38px;
      height: 38px;
    }
    #ball {
      width: 40px;
      height: 40px;
      bottom: 60px;
      left: 110px;
      background-image:
        radial-gradient(circle at 12px 12px, #222 5px, transparent 6px),
        radial-gradient(circle at 28px 12px, #222 5px, transparent 6px),
        radial-gradient(circle at 20px 28px, #222 5px, transparent 6px);
    }
  }
</style>
</head>
<body>

<header>
  <h1>Penaltis Mundial 2022</h1>
  <p>Selecciona tu equipo y gana el torneo de penaltis</p>
</header>

<main>
  <section id="team-selection" aria-label="Selección de equipo">
    <h2>Elige tu equipo</h2>
    <div id="teams-list" role="listbox" tabindex="0" aria-label="Lista de equipos">
      <!-- Equipos se cargan aquí -->
    </div>
  </section>

  <section id="game-container" aria-live="polite" aria-atomic="true">
    <div id="stage-title" aria-label="Etapa del torneo">Etapa:</div>
    <div id="match-info" aria-label="Información del partido">Partido:</div>

    <div id="field" role="application" aria-label="Campo de penales con portería, jugador y portero">
      <div id="goal" aria-label="Portería">
        <!-- Nueve zonas clicables para tiro -->
        <div class="goal-zone row-1 col-1" data-zone="0" tabindex="0" role="button" aria-pressed="false" aria-label="Zona arriba izquierda"></div>
        <div class="goal-zone row-1 col-2" data-zone="1" tabindex="0" role="button" aria-pressed="false" aria-label="Zona arriba centro"></div>
        <div class="goal-zone row-1 col-3" data-zone="2" tabindex="0" role="button" aria-pressed="false" aria-label="Zona arriba derecha"></div>
        <div class="goal-zone row-2 col-1" data-zone="3" tabindex="0" role="button" aria-pressed="false" aria-label="Zona medio izquierda"></div>
        <div class="goal-zone row-2 col-2" data-zone="4" tabindex="0" role="button" aria-pressed="false" aria-label="Zona medio centro"></div>
        <div class="goal-zone row-2 col-3" data-zone="5" tabindex="0" role="button" aria-pressed="false" aria-label="Zona medio derecha"></div>
        <div class="goal-zone row-3 col-1" data-zone="6" tabindex="0" role="button" aria-pressed="false" aria-label="Zona abajo izquierda"></div>
        <div class="goal-zone row-3 col-2" data-zone="7" tabindex="0" role="button" aria-pressed="false" aria-label="Zona abajo centro"></div>
        <div class="goal-zone row-3 col-3" data-zone="8" tabindex="0" role="button" aria-pressed="false" aria-label="Zona abajo derecha"></div>
      </div>

      <div id="player" aria-label="Jugador tirador">
        <div class="human-head"></div>
        <div class="human-body"></div>
      </div>

      <div id="keeper" aria-label="Portero">
        <div class="human-head"></div>
        <div class="human-body"></div>
      </div>

      <div id="ball" aria-label="Balón de fútbol"></div>
    </div>

    <div class="buttons-container">
      <button id="start-btn" aria-disabled="true">Iniciar Partido</button>
      <button id="next-shot-btn" disabled>Siguiente Tiro</button>
    </div>

    <div id="info-panel" role="status" aria-live="polite" aria-atomic="true"></div>
  </section>
</main>

<script>
  // Datos simplificados, solo unos países para ejemplo y banderas CDN públicas
  const teamsData = [
    { name: "Argentina", flag: "https://flagcdn.com/ar.svg", colors: ["#75aadb", "#ffffff"] },
    { name: "Brasil", flag: "https://flagcdn.com/br.svg", colors: ["#009b3a", "#fedf00"] },
    { name: "Francia", flag: "https://flagcdn.com/fr.svg", colors: ["#0055a4", "#ef4135"] },
    { name: "España", flag: "https://flagcdn.com/es.svg", colors: ["#c60b1e", "#f1bf00"] },
  ];

  const teamSelection = document.getElementById("teams-list");
  const gameContainer = document.getElementById("game-container");
  const startBtn = document.getElementById("start-btn");
  const nextShotBtn = document.getElementById("next-shot-btn");
  const infoPanel = document.getElementById("info-panel");
  const stageTitle = document.getElementById("stage-title");
  const matchInfo = document.getElementById("match-info");

  const player = document.getElementById("player");
  const keeper = document.getElementById("keeper");
  const ball = document.getElementById("ball");
  const goalZones = document.querySelectorAll(".goal-zone");

  let selectedTeam = null;
  let shotsTaken = 0;
  let maxShots = 5;
  let playerScore = 0;
  let keeperScore = 0;
  let gameInProgress = false;

  // Carga equipos en selección
  function loadTeams() {
    teamsData.forEach((team, index) => {
      const div = document.createElement("div");
      div.className = "team-card";
      div.tabIndex = 0;
      div.setAttribute("role", "option");
      div.setAttribute("aria-selected", "false");
      div.dataset.index = index;

      div.innerHTML = `<img src="${team.flag}" alt="Bandera de ${team.name}" />
                       <span>${team.name}</span>`;
      div.addEventListener("click", () => selectTeam(index));
      div.addEventListener("keydown", e => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          selectTeam(index);
        }
      });
      teamSelection.appendChild(div);
    });
  }

  // Selección equipo
  function selectTeam(index) {
    if (gameInProgress) return;
    selectedTeam = teamsData[index];
    Array.from(teamSelection.children).forEach((child, i) => {
      child.classList.toggle("selected", i === index);
      child.setAttribute("aria-selected", i === index ? "true" : "false");
    });
    startBtn.disabled = false;
    startBtn.setAttribute("aria-disabled", "false");
    infoPanel.textContent = `Has seleccionado: ${selectedTeam.name}. Pulsa "Iniciar Partido" para comenzar.`;
  }

  // Iniciar partido
  startBtn.addEventListener("click", () => {
    if (!selectedTeam) return;
    gameInProgress = true;
    shotsTaken = 0;
    playerScore = 0;
    keeperScore = 0;

    stageTitle.textContent = "Etapa: Final de Penaltis";
    matchInfo.textContent = `Equipo: ${selectedTeam.name}`;
    infoPanel.textContent = "Elige dónde disparar haciendo clic en una zona de la portería.";

    // Mostrar juego, ocultar selección
    document.getElementById("team-selection").style.display = "none";
    gameContainer.style.display = "block";

    // Establecer colores jugador según equipo
    setPlayerColors(selectedTeam.colors);

    startBtn.disabled = true;
    startBtn.setAttribute("aria-disabled", "true");
    nextShotBtn.disabled = true;
    nextShotBtn.setAttribute("aria-disabled", "true");
  });

  // Configura colores jugador delantero
  function setPlayerColors(colors) {
    // Usamos solo primer color para cuerpo, segundo para detalles si quieres
    player.style.setProperty('--primary-color', colors[0]);
    player.style.setProperty('--secondary-color', colors[1] || colors[0]);
    // Aplicamos clases para que CSS cambie color
    // Por simplificar actualizo el background directamente:
    const body = player.querySelector(".human-body");
    body.style.background = `linear-gradient(to bottom, ${colors[0]}, ${shadeColor(colors[0], -40)})`;
  }

  // Función para oscurecer color
  function shadeColor(color, percent) {
    // color es #rrggbb, percent es negativo para oscurecer
    let R = parseInt(color.substring(1,3),16);
    let G = parseInt(color.substring(3,5),16);
    let B = parseInt(color.substring(5,7),16);

    R = parseInt(R * (100 + percent) / 100);
    G = parseInt(G * (100 + percent) / 100);
    B = parseInt(B * (100 + percent) / 100);

    R = (R<255)?R:255;
    G = (G<255)?G:255;
    B = (B<255)?B:255;

    const RR = (R.toString(16).length==1)?"0"+R.toString(16):R.toString(16);
    const GG = (G.toString(16).length==1)?"0"+G.toString(16):G.toString(16);
    const BB = (B.toString(16).length==1)?"0"+B.toString(16):B.toString(16);

    return "#" + RR + GG + BB;
  }

  // Disparo (clic en zona portería)
  goalZones.forEach(zone => {
    zone.addEventListener("click", () => {
      if (!gameInProgress || nextShotBtn.disabled === false) return;
      shoot(zone.dataset.zone);
    });
    zone.addEventListener("keydown", e => {
      if ((e.key === "Enter" || e.key === " ") && !nextShotBtn.disabled) {
        e.preventDefault();
        shoot(e.target.dataset.zone);
      }
    });
  });

  // Control disparo
  function shoot(zone) {
    nextShotBtn.disabled = false;
    nextShotBtn.setAttribute("aria-disabled", "false");
    infoPanel.textContent = "Disparo en curso...";

    // Marca zona seleccionada visualmente
    goalZones.forEach(gz => {
      gz.classList.remove("selected");
      gz.setAttribute("aria-pressed", "false");
    });
    const selectedZone = [...goalZones].find(gz => gz.dataset.zone === zone);
    if (selectedZone) {
      selectedZone.classList.add("selected");
      selectedZone.setAttribute("aria-pressed", "true");
    }

    // Animación disparo balón
    ball.className = "";
    // Mapeamos zona a animación balón para que coincida con zona (izq, centro, der)
    let animClass = "shoot-center";
    const zoneNum = parseInt(zone);
    if ([0,3,6].includes(zoneNum)) animClass = "shoot-left";
    else if ([2,5,8].includes(zoneNum)) animClass = "shoot-right";
    ball.classList.add(animClass);

    // Posiciones portero y jugador se ajustan aquí si quieres

    // Portero intenta adivinar (aleatorio)
    const keeperGuess = Math.floor(Math.random() * 9);

    // Saltos portero segun adivina izq o derecha
    keeper.classList.remove("jump-left", "jump-right");
    if ([0,3,6].includes(keeperGuess)) {
      keeper.classList.add("jump-left");
    } else if ([2,5,8].includes(keeperGuess)) {
      keeper.classList.add("jump-right");
    } // centro no salta

    // Decidir resultado tras animación
    setTimeout(() => {
      let goal = keeperGuess !== zoneNum;
      shotsTaken++;
      if (goal) {
        playerScore++;
        infoPanel.textContent = "¡Gol!";
      } else {
        keeperScore++;
        infoPanel.textContent = "¡Parada del portero!";
      }
      updateScore();

      // Desactivar botones disparo, activar siguiente tiro
      goalZones.forEach(gz => {
        gz.classList.remove("selected");
        gz.setAttribute("aria-pressed", "false");
      });
      nextShotBtn.disabled = false;
      nextShotBtn.setAttribute("aria-disabled", "false");

      if (shotsTaken >= maxShots) {
        endGame();
      }
    }, 700);
  }

  // Siguiente tiro resetea balón y portero
  nextShotBtn.addEventListener("click", () => {
    ball.className = "";
    keeper.classList.remove("jump-left", "jump-right");
    infoPanel.textContent = "Elige dónde disparar haciendo clic en una zona de la portería.";
    nextShotBtn.disabled = true;
    nextShotBtn.setAttribute("aria-disabled", "true");
  });

  // Actualiza marcador
  function updateScore() {
    matchInfo.textContent = `${selectedTeam.name} ${playerScore} - ${keeperScore} Portero`;
  }

  // Fin juego
  function endGame() {
    gameInProgress = false;
    nextShotBtn.disabled = true;
    nextShotBtn.setAttribute("aria-disabled", "true");
    infoPanel.textContent += " Juego terminado.";

    let winnerText;
    if (playerScore > keeperScore) {
      winnerText = `¡Felicidades! ${selectedTeam.name} ha ganado el torneo. 🎉`;
    } else if (playerScore < keeperScore) {
      winnerText = "El portero ha ganado, ¡mejor suerte la próxima vez!";
    } else {
      winnerText = "Empate. ¡Fue un partido reñido!";
    }
    alert(winnerText);

    // Volver a seleccionar equipo
    resetGame();
  }

  // Reset juego
  function resetGame() {
    gameInProgress = false;
    shotsTaken = 0;
    playerScore = 0;
    keeperScore = 0;
    selectedTeam = null;
    startBtn.disabled = true;
    startBtn.setAttribute("aria-disabled", "true");
    nextShotBtn.disabled = true;
    nextShotBtn.setAttribute("aria-disabled", "true");
    infoPanel.textContent = "";
    matchInfo.textContent = "";
    stageTitle.textContent = "";
    ball.className = "";
    keeper.classList.remove("jump-left", "jump-right");
    document.getElementById("team-selection").style.display = "block";
    gameContainer.style.display = "none";

    Array.from(teamSelection.children).forEach(child => {
      child.classList.remove("selected");
      child.setAttribute("aria-selected", "false");
    });
  }

  // Inicialización
  loadTeams();

</script>

</body>
</html>
